
* [<a href="#">图</a>](#图)
* [<a href="#">组成</a>](#组成)
  * [<a href="#">首部</a>](#首部)
    * [<a href="#">源端口</a>](#源端口)
    * [<a href="#">目的端口</a>](#目的端口)
    * [<a href="#">序号(seq)</a>](#序号seq)
    * [<a href="#">确认号(ack)</a>](#确认号ack)
    * [<a href="#">数据偏移</a>](#数据偏移)
    * [<a href="#">保留</a>](#保留)
    * [<a href="#">紧急URG</a>](#紧急urg)
    * [<a href="#">确认ACK</a>](#确认ack)
    * [<a href="#">推送 PSH</a>](#推送-psh)
    * [<a href="#">复位RST</a>](#复位rst)
    * [<a href="#">同步SYN</a>](#同步syn)
    * [<a href="#">终止FIN</a>](#终止fin)
    * [<a href="#">窗口</a>](#窗口)
    * [<a href="#">检验和</a>](#检验和)
    * [<a href="#">紧急指针</a>](#紧急指针)
    * [<a href="#">选项</a>](#选项)
  * [<a href="#">数据部分</a>](#数据部分)


# [图](#)
![img.png](../img/计算机网络/TCP报文.png)

# [组成](#)
## [首部](#)
### [源端口](#)
  - 16bits，范围0~65525
### [目的端口](#)
  - 16bits，范围同上

### [序号(seq)](#)
  - TCP是面向字节流的。在一个TCP连接中传送的字节流中的每一个字节都按顺序编号。整个要传送的字节流的起始序号必须在连接建立时设置。首部中的序号字段值则是指的是本报文段所发送的数据的第一个字节的序号。长度为4字节，序号是32bit的无符号数,序号到达232 - 1后又从0开始。
### [确认号(ack)](#)
  - 确认号，32bits，期望收到对方的下一个报文段的数据的第一个字节的序号。
  - 确认序号为上次接收的最后一个字节序号加1.
### [数据偏移](#)
  - 也叫首部长度，占4个bit,它指出TCP报文段的数据起始处距离TCP报文段的起始处有多远
### [保留](#)
  - 占6位，保留为今后使用，但目前应置为0。
### [紧急URG](#)
  - 紧急比特，1bit，当 URG=1 时，表明紧急指针字段有效。它告诉系统此报文段中有紧急数据，应尽快传送(相当于高优先级的数据)
### [确认ACK](#)
  - 仅当ACK = 1时确认号字段才有效，当ACK = 0时确认号无效。TCP规定，在连接建立后所有的传送的报文段都必须把ACK置为1。
### [推送 PSH](#)
  - 当两个应用进程进行交互式的通信时，有时在一端的应用进程希望在键入一个命令后立即就能收到对方的响应。在这种情况下，TCP就可以使用推送（push）操作。发送方TCP把PSH置为1，并立即创建一个报文段发送出去。接收方TCP收到PSH=1的报文段，就尽快地（即“推送”向前）交付接收应用进程。而不用再等到整个缓存都填满了后再向上交付。
### [复位RST](#)
  - 当RST=1时，表明TCP连接中出现了严重错误（如由于主机崩溃或其他原因），必须释放连接，然后再重新建立传输连接。RST置为1还用来拒绝一个非法的报文段或拒绝打开一个连接。
### [同步SYN](#)
  - 在连接建立时用来同步序号。当SYN=1而ACK=0时，表明这是一个连接请求报文段。对方若同意建立连接，则应在响应的报文段中使SYN=1和ACK=1。
### [终止FIN](#)
  - 用来释放一个连接。当FIN=1时，表明此报文段的发送发的数据已发送完毕，并要求释放运输连接。
### [窗口](#)
  - 16bits，窗口字段用来控制对方发送的数据量，单位为字节。TCP 连接的一端根据设置的缓存空间大小确定自己的接收窗口大小，然后通知对方以确定对方的发送窗口的上限。
  - 窗口字段明确指出了现在允许对方发送的数据量。窗口值经常在动态变化。
### [检验和](#)
  - 占2字节。检验和字段检验的范围包括首部和数据这两部分。和UDP用户数据报一样，在计算检验和时，要在TCP报文段的前面加上12字节的伪首部
    - 伪首部
      - 伪首部的出现：发送方或接收方根据IP报文首部获得8字节的源地址+目的地址、2字节的0字段+UDP协议字段、2字节的数据长度，得到12字节伪首部，临时添加在首部前面。
      - 伪首部的消失：发送方将计算完毕的校验和填入首部的校验和字段后，去除伪首部发送UDP报文。
      - 伪首部的作用：仅为了计算校验和使用。
      - 发送方将UDP伪首部、首部、数据每16位一组进行二进制反码求和，再将求和结果求反码，填入校验和字段。
      - 接收方收到UDP报文后，生成伪首部，将伪首部、首部、数据每16位一组进行二进制反码求和，若求和结果全为1则无差错传输，否则丢弃。
### [紧急指针](#)
  - 占2字节。紧急指针仅在URG=1时才有意义，它指出本报文段中的紧急数据的字节数（紧急数据结束后就是普通数据） 。因此，在紧急指针指出了紧急数据的末尾在报文段中的位置。当所有紧急数据都处理完时，TCP就告诉应用程序恢复到正常操作。值得注意的是，即使窗口为0时也可以发送紧急数据。
### [选项](#)
  - 长度可变，最长可达40个字节。当没有使用“选项”时，TCP的首部长度是20字节。
## [数据部分](#)